% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/blas_threads.R
\name{with_blas_thread_management}
\alias{with_blas_thread_management}
\title{Execute code with BLAS thread management}
\usage{
with_blas_thread_management(expr)
}
\arguments{
\item{expr}{Expression to evaluate}
}
\value{
Result of evaluating expr
}
\description{
Wrapper function that automatically manages BLAS threads when using
parallel processing. Sets BLAS to single-threaded mode if parallel
workers are detected, then restores original thread count.
}
\details{
Thread oversubscription occurs when:
\itemize{
\item Future workers: e.g., 4 parallel R processes
\item BLAS threads per worker: e.g., 8 threads each
\item Total threads: 4 * 8 = 32 threads on a 4-core machine!
}

This causes severe performance degradation. The solution is to set
BLAS to single-threaded (n=1) when using parallel workers, so:
\itemize{
\item Future workers: 4 parallel R processes
\item BLAS threads per worker: 1 thread each
\item Total threads: 4 * 1 = 4 threads (optimal for 4 cores)
}
}
\examples{
\dontrun{
# Without management (bad - 32 threads on 4 cores)
future::plan(multisession, workers = 4)
result <- furrr::future_map(1:100, heavy_blas_function)

# With management (good - 4 threads on 4 cores)
future::plan(multisession, workers = 4)
result <- with_blas_thread_management({
  furrr::future_map(1:100, heavy_blas_function)
})
}
}
\keyword{internal}
